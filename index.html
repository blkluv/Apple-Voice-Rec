<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Voice Recorder" />
    <meta name="theme-color" content="#4A90E2" />

    <title>Voice Recorder - Free Voice Recording</title>

    <link rel="manifest" href="./manifest.json" />
    <link rel="apple-touch-icon" href="./icons/icon-192.png" />
    <link rel="stylesheet" href="./css/modern-styles.css" />

    <meta name="description" content="Free Voice Recorder PWA - Install and use offline on your iPhone" />
</head>
<body>
    <div class="container" role="main">
        <!-- Header -->
        <header class="header">
            <h1>üéôÔ∏è REC.HAHZ.LIVE</h1>
            <p class="app-description">A privacy-focused voice recorder that works offline. Record, save, manage and tokenize your audio clips (11 secs or less) to monetize your voice.!</p>
            <div class="status-indicator" id="statusIndicator" aria-live="polite" aria-atomic="true" role="status" aria-label="Recording status">
                <span class="status-dot" aria-hidden="true"></span>
                <span class="status-text">Ready</span>
            </div>
        </header>

        <!-- Recording Controls -->
        <main class="main-content">
            <!-- Timer Display -->
            <section class="timer-display" id="timerDisplay" aria-label="Recording timer">
                <span class="timer-text" aria-live="off" aria-atomic="true">00:00:00</span>
                <div class="audio-visualizer" id="audioVisualizer" aria-hidden="true">
                    <canvas id="visualizerCanvas" width="300" height="60"></canvas>
                </div>
            </section>

            <!-- Control Buttons -->
            <div class="controls" role="group" aria-label="Recording controls">
                <button class="btn btn-record" id="recordBtn" aria-label="Start recording" aria-pressed="false" type="button">
                    <svg class="icon-record" viewBox="0 0 24 24" width="32" height="32" aria-hidden="true" focusable="false">
                        <circle cx="12" cy="12" r="10" fill="currentColor" />
                    </svg>
                    <span>Start</span>
                </button>

                <button class="btn btn-pause" id="pauseBtn" disabled aria-label="Pause recording" aria-pressed="false" type="button">
                    <svg class="icon-pause" viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" focusable="false">
                        <rect x="6" y="4" width="4" height="16" fill="currentColor" />
                        <rect x="14" y="4" width="4" height="16" fill="currentColor" />
                    </svg>
                    <span>Pause</span>
                </button>

                <button class="btn btn-stop" id="stopBtn" disabled aria-label="Stop recording" aria-pressed="false" type="button">
                    <svg class="icon-stop" viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" focusable="false">
                        <rect x="6" y="6" width="12" height="12" fill="currentColor" />
                    </svg>
                    <span>Stop</span>
                </button>
            </div>

            <!-- Audio Quality Setting -->
            <form class="settings" aria-label="Audio quality settings">
                <label for="audioQuality">Audio Quality:</label>
                <select id="audioQuality" class="select-quality" name="audioQuality" aria-describedby="qualityDesc">
                    <option value="low">Low (32 kbps)</option>
                    <option value="medium" selected>Medium (128 kbps)</option>
                    <option value="high">High (320 kbps)</option>
                </select>
                <div id="qualityDesc" class="visually-hidden">Choose the desired audio recording quality.</div>
            </form>
        </main>

        <!-- Add this right after the recordings list header -->
        <section class="recordings-section" aria-label="Saved recordings">
             <h2>üìÅ Recordings</h2>
         <!-- NEW MINT BUTTON -->
         <a href="https://atl5d.com/services/mint-my-music/" id="mintRecordingBtn" class="mint-btn" style="display: none;">
        ü™ô Mint this Rec.
         </a>
        <div class="recordings-list" id="recordingsList" aria-live="polite" aria-atomic="true">
        <p class="empty-message">No recordings available</p>
        </div>
        </section>

        <!-- Install Prompt -->
        <aside class="install-prompt" id="installPrompt" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="installPromptTitle" aria-describedby="installPromptDesc">
            <h3 id="installPromptTitle">Add to Home Screen</h3>
            <p id="installPromptDesc">Install the app on your home screen for quick access and offline use.</p>
            <button class="btn btn-install" id="installBtn" type="button">Install</button>
            <button class="btn btn-dismiss" id="dismissBtn" type="button">Maybe Later</button>
        </aside>
    </div>

    <!-- Hidden Audio Player -->
    <audio id="audioPlayer" controls style="display: none;"></audio>

    <!-- Scripts -->
    <script src="./js/app.js"></script>
    <script src="./js/recorder.js"></script>
    <script src="./js/storage.js"></script>

    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => console.log('Service Worker registered:', registration))
                    .catch(error => console.log('Service Worker registration failed:', error));
            });
        }

        // PWA Install Prompt Handling
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').style.display = 'block';
        });

        document.getElementById('installBtn').addEventListener('click', () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(choiceResult => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    }
                    deferredPrompt = null;
                    document.getElementById('installPrompt').style.display = 'none';
                });
            }
        });

        document.getElementById('dismissBtn').addEventListener('click', () => {
            document.getElementById('installPrompt').style.display = 'none';
        });
    </script>
</body>
</html>
